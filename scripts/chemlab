#!/usr/bin/env python
import argparse
import sys
sys.path.append('/home/gabriele/workspace/chemlab/')
import chemlab as cl
import os
from pyxdr import XTCReader
import time

def view(args):
    from chemlab.io.gro import parse_gro, read_gro_traj
    from chemlab.graphics import display_system, display_trajectory
    
    base, ext = os.path.splitext(args.filename)
    
    if ext == '.gro':
        if not args.traj:
            sys = parse_gro(args.filename)
	    display_system(sys)
	else:
            print 'Parsing'
            t0 = time.time()
            sys = parse_gro(args.filename)
            print 'Elapsed', time.time() - t0
            t0 = time.time()
            
            print 'Trajectory parsing'
            frames = []
            for frame in XTCReader(args.traj):
                frames.append(frame.coords)
            print 'Elapsed', time.time() - t0
            t0 = time.time()

            display_trajectory(sys, frames)
	
def plot(args):
    base, ext = os.path.splitext(args.filename)

parser = argparse.ArgumentParser()

subparsers = parser.add_subparsers()

# Contrib plugins
from chemlab.contrib import gromacs
gromacs.setup_commands(subparsers)

view_parser = subparsers.add_parser('view')
view_parser.add_argument('filename', type=str)
view_parser.add_argument('--traj', action='store', type=str)
view_parser.add_argument('--highlight', nargs='*', type=int)

view_parser.set_defaults(func=view)

args = parser.parse_args(sys.argv[1:])
args.func(args)